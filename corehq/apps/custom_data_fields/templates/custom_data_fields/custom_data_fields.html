{% extends 'settings/base_template.html' %}
{% load crispy_forms_tags %}
{% load hq_shared_tags %}
{% load hqstyle_tags %}
{% load i18n %}

{% block js %}
{{ block.super }}
    <script type="text/javascript" src="{% static 'hqwebapp/js/lib/jquery-ui/jquery-ui-1.8.16.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'hqwebapp/js/knockout-bindings.js' %}"></script>
    <script type="text/javascript" src="{% static 'custom_data_fields/js/custom_data_fields.js' %}"></script>
{% endblock %}

{% block js-inline %}
{{ block.super }}
    <script>
        var customDataFieldsModel = new CustomDataFieldsModel();
        customDataFieldsModel.init({{ custom_fields|JSON }});
        ko.applyBindings(customDataFieldsModel, $('#custom-fields-form').get(0));
    </script>
{% endblock %}

{% block main_column %}
    <form id="custom-fields-form"
          action="."
          method="POST"
          data-bind="submit: submitFields"
          class="form form-horizontal">
        {% csrf_token %}
        <fieldset>
            <legend>
                {{ view.page_name }}
            </legend>

            {% if custom_fields_form.data_fields.errors %}
                {% for error in custom_fields_form.data_fields.errors %}
                    <div class="alert alert-error">
                        {{ error|safe }}
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                    </div>
                {% endfor %}
            {% endif %}
            <div class="control-group">
                <label class="control-label">{{ view.form_label }}</label>
                <div class="controls">
                    <p>
                        <button class="btn btn-success"
                                data-bind="click: addField"
                                type="button">
                            <i class="icon-plus"></i>
                            Add a Field
                        </button>
                    </p>
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th></th>
                                <th>{% trans "Key" %}</th>
                                <th>{% trans "Field Label" %}</th>
                                <th>{% trans "Required" %}</th>
                                <th>{% trans "Delete" %}</th>
                            </tr>
                        </thead>
                        <tbody data-bind="sortable: data_fields">
                            <tr>
                                <td>
                                    <i class="icon-sort sortable-handle"></i>
                                </td>
                                <td>
                                    <input class="input-block-level" type="text" data-bind="value: slug"/>
                                </td>
                                <td>
                                    <input class="input-block-level" type="text" data-bind="value: label"/>
                                </td>
                                <td>
                                    <input type="checkbox" data-bind="checked: is_required"/>
                                </td>
                                <td>
                                    <button type="button"
                                            class="btn btn-danger"
                                            data-bind="click: $root.removeField">
                                        <i class="icon-remove"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </fieldset>

        <div class="form-actions"><button id="save-custom-fields" class="btn btn-primary" type="submit">Save Fields</button></div>
    </form>
{% endblock %}
