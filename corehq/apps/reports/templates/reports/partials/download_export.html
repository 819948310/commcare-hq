{% load i18n %}
{% load hq_shared_tags %}

{% block js %}
    <script type="text/javascript" src="{% static 'reports/javascripts/reports.download_export.js' %}"></script>
    <script type="text/javascript" src="{% static 'reports/ko/export.manager.js' %}"></script>
{% endblock %}

{% block js-inline %}
    <script type="text/javascript">
        var exportDownloader = new HQExportDownloader({
            domain: '{{ domain }}'
        });
        exportDownloader.init();

        var filterParams = '{{ get_filter_params.urlencode|safe }}';
        var jsonFilterParams = {{ get_filter_params|JSON }};
        var customExportManager = new ExportManager( {
            domain: '{{ domain }}',
            exportFilters: filterParams,
            jsonExportFilters: jsonFilterParams,
            bulkDownloadUrl: '{% url "export_bulk_download" domain %}',
            is_custom: true,
            is_deid_form_report: {{ is_deid_form_report|JSON }}
        } );

        ko.applyBindings(customExportManager, $('#downloads')[0]);
    </script>
{% endblock %}

{% block reportcontent %}
<section id="downloads">
    <a data-toggle="modal" href="#export-download-status"
                   data-backdrop="static"
                   data-formname="{{ export.name }}"
                   data-xmlns="{{ export.xmlns }}"
                   data-exportid="{{ export.get_id }}"
                   data-exporttype="form"
                   data-dlocation='{% url "export_custom_data" domain export.get_id %}'
                   data-format="{{ export.default_format }}"
                   data-bind="click: requestDownload"
                   class="dl-export btn btn-primary"><i class="icon-download-alt icon-white"></i> {% trans "Download" %}</a>
</section>
{% endblock reportcontent %}

{% block modals %}
{% include 'reports/partials/export_download_modal.html' %}
{% endblock %}
